<head>
  <link rel="stylesheet" href="/style.css" />
</head>

<h1 class="feed-title">Feed</h1>

<!-- Create post form -->
<form class="post-form" action="/feed/create" method="POST">
  <textarea
    name="content"
    class="post-textarea"
    placeholder="What's happening?"
    required
  ></textarea>
  <button type="submit" class="post-btn">Post</button>
</form>

<% if (posts.length === 0) { %>
<p class="empty-feed">Your feed is empty. Follow people to see their posts!</p>
<% } else { %>
<ul class="post-list">
  <% posts.forEach(post => { %>
  <li class="post-item">
    <strong>
      <a class="author-link" href="/people/<%= post.authorId._id %>">
        <%= post.authorId.username %> </a
      >:
    </strong>

    <span class="post-content"><%= post.content %></span>

    <!-- Post timestamps -->
<div class="post-meta">
  Posted on <%= new Date(post.createdAt).toLocaleString() %>
  <% if(post.edited){ %>
    (edited <%= new Date(post.updatedAt).toLocaleString() %>)
  <% } %>
</div>


    <!-- Like / Unlike button -->
    <form class="like-form" method="POST" action="/feed/<%= post._id %>/like">
      <button type="submit" class="like-btn">
        <%= (post.likes.includes(currentUser._id) ? 'Unlike' : 'Like') + ' (' +
        post.likes.length + ')' %>
      </button>
    </form>

    <!-- Edit / Delete buttons (optional) -->
    <% if (post.authorId._id.toString() === currentUser._id.toString()) { %>
    <div class="post-actions">
      <a href="/feed/edit/<%= post._id %>" class="edit-btn">Edit</a>
      <form
        action="/feed/delete/<%= post._id %>"
        method="POST"
        style="display: inline"
      >
        <button type="submit" class="delete-btn">Delete</button>
      </form>
    </div>
    <% } %>
  </li>
  <% }) %>
</ul>
<% } %>
